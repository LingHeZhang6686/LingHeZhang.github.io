# 2. é€‰æ‹©è¦å±•ç¤ºçš„åŸºå› 
cat("é€‰æ‹©åŸºå› ...\n")
# å¦‚æœæœ‰é‡è¦æ€§æ•°æ®ï¼Œä½¿ç”¨å®ƒ
if (exists("imp_df") && nrow(imp_df) > 0) {
cat("ä½¿ç”¨é‡è¦æ€§æ’åé€‰æ‹©åŸºå› ...\n")
# è·å–imp_dfä¸­çš„åŸºå› å
important_genes <- imp_df$Gene
# æ‰¾å‡ºå®é™…åœ¨æ•°æ®ä¸­å­˜åœ¨çš„åŸºå› 
available_genes <- intersect(important_genes, colnames(important_data_matrix))
if (length(available_genes) > 5) {
# ä½¿ç”¨å‰20ä¸ªå¯ç”¨çš„åŸºå› 
n_genes <- min(20, length(available_genes))
selected_genes <- available_genes[1:n_genes]
cat("ä½¿ç”¨é‡è¦æ€§é€‰æ‹©", n_genes, "ä¸ªåŸºå› \n")
} else {
cat("é‡è¦æ€§åŸºå› å¤ªå°‘ï¼Œä½¿ç”¨é«˜æ–¹å·®åŸºå› \n")
# è®¡ç®—æ–¹å·®
gene_variance <- apply(important_data_matrix, 2, var, na.rm = TRUE)
selected_genes <- names(sort(gene_variance, decreasing = TRUE))[1:min(20, length(gene_variance))]
}
} else {
cat("æ²¡æœ‰é‡è¦æ€§æ•°æ®ï¼Œä½¿ç”¨é«˜æ–¹å·®åŸºå› ...\n")
# è®¡ç®—æ–¹å·®
gene_variance <- apply(important_data_matrix, 2, var, na.rm = TRUE)
selected_genes <- names(sort(gene_variance, decreasing = TRUE))[1:min(20, length(gene_variance))]
}
# 3. å‡†å¤‡çƒ­å›¾æ•°æ®
cat("å‡†å¤‡çƒ­å›¾æ•°æ®...\n")
heatmap_data <- important_data_matrix[, selected_genes, drop = FALSE]
# æ£€æŸ¥æ•°æ®
cat("çƒ­å›¾æ•°æ®ç»´åº¦:", dim(heatmap_data), "\n")
cat("åŸºå› æ•°:", length(selected_genes), "\n")
# ç§»é™¤ä»»ä½•NAæˆ–Infå€¼
if (any(is.na(heatmap_data))) {
cat("å‘ç°NAå€¼ï¼Œç”¨åˆ—å‡å€¼å¡«å……...\n")
for (j in 1:ncol(heatmap_data)) {
col_mean <- mean(heatmap_data[, j], na.rm = TRUE)
if (is.na(col_mean)) col_mean <- 0
heatmap_data[is.na(heatmap_data[, j]), j] <- col_mean
}
}
if (any(is.infinite(heatmap_data))) {
cat("å‘ç°æ— ç©·å¤§å€¼ï¼Œç”¨æœ€å¤§å€¼æ›¿æ¢...\n")
for (j in 1:ncol(heatmap_data)) {
col_max <- max(heatmap_data[!is.infinite(heatmap_data[, j]), j], na.rm = TRUE)
if (is.infinite(col_max) || is.na(col_max)) col_max <- 1
heatmap_data[is.infinite(heatmap_data[, j]), j] <- col_max
}
}
# 4. æ ‡å‡†åŒ–æ•°æ®ï¼ˆæŒ‰è¡Œï¼‰
cat("æ ‡å‡†åŒ–æ•°æ®...\n")
tryCatch({
heatmap_data_scaled <- t(scale(t(heatmap_data)))
# å¦‚æœæ ‡å‡†åŒ–äº§ç”ŸNA/Infï¼Œç”¨0æ›¿ä»£
heatmap_data_scaled[is.na(heatmap_data_scaled)] <- 0
heatmap_data_scaled[is.infinite(heatmap_data_scaled)] <- 0
}, error = function(e) {
cat("æ ‡å‡†åŒ–å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹æ•°æ®:", e$message, "\n")
heatmap_data_scaled <- heatmap_data
})
# 5. å‡†å¤‡æ³¨é‡Š
cat("å‡†å¤‡æ ·æœ¬æ³¨é‡Š...\n")
annotation_df <- data.frame(
CancerType = as.character(labels$Class),
row.names = rownames(heatmap_data_scaled)
)
# ç¡®ä¿è¡ŒååŒ¹é…
if (!all(rownames(annotation_df) == rownames(heatmap_data_scaled))) {
cat("è­¦å‘Šï¼šè¡Œåä¸åŒ¹é…ï¼Œé‡æ–°å¯¹é½...\n")
# é‡æ–°æ’åºannotation_dfä»¥åŒ¹é…heatmap_data_scaled
annotation_df <- annotation_df[rownames(heatmap_data_scaled), , drop = FALSE]
}
# 6. è®¾ç½®é¢œè‰²
cancer_colors <- list(
CancerType = c(
BRCA = "#E41A1C",
COAD = "#377EB8",
KIRC = "#4DAF4A",
LUAD = "#984EA3",
PRAD = "#FF7F00"
)
)
# 7. ç»˜åˆ¶çƒ­å›¾ - ä¿®æ”¹ä¸ºå•ç‹¬ä¿å­˜TIFFæ–‡ä»¶
tiff("top_genes_heatmap.tiff", width = 14, height = 10, units = "in", res = 300, compression = "lzw")
tryCatch({
pheatmap(heatmap_data_scaled,
main = paste("Expression Heatmap of", ncol(heatmap_data_scaled), "Important Genes"),
color = colorRampPalette(c("blue", "white", "red"))(100),
scale = "row",  # æŒ‰è¡Œæ ‡å‡†åŒ–
cluster_rows = TRUE,
cluster_cols = TRUE,
show_rownames = FALSE,  # ä¸æ˜¾ç¤ºæ ·æœ¬å
show_colnames = TRUE,   # æ˜¾ç¤ºåŸºå› å
annotation_row = annotation_df,
annotation_colors = cancer_colors,
fontsize_col = 8,
fontsize_row = 6,
border_color = NA,
treeheight_row = 50,
treeheight_col = 50)
}, error = function(e) {
cat("pheatmapé”™è¯¯ï¼Œå°è¯•ç®€åŒ–ç‰ˆæœ¬:", e$message, "\n")
# ç®€åŒ–ç‰ˆæœ¬
pheatmap(heatmap_data_scaled,
main = paste("Expression Heatmap of", ncol(heatmap_data_scaled), "Genes"),
color = colorRampPalette(c("blue", "white", "red"))(100),
scale = "none",
cluster_rows = TRUE,
cluster_cols = TRUE,
show_rownames = FALSE,
show_colnames = TRUE,
fontsize_col = 8)
})
dev.off()
cat("âœ“ çƒ­å›¾å·²ä¿å­˜ä¸º top_genes_heatmap.tiff\n")
# 8. é¢å¤–ï¼šåˆ›å»ºæŒ‰ç™Œç—‡ç±»å‹åˆ†ç»„çš„å¹³å‡è¡¨è¾¾çƒ­å›¾
cat("\nåˆ›å»ºæŒ‰ç™Œç—‡ç±»å‹åˆ†ç»„çš„å¹³å‡è¡¨è¾¾çƒ­å›¾...\n")
# è®¡ç®—æ¯ç§ç™Œç—‡ç±»å‹çš„å¹³å‡è¡¨è¾¾
cancer_types <- unique(labels$Class)
mean_expression <- matrix(NA, nrow = length(cancer_types), ncol = ncol(heatmap_data))
rownames(mean_expression) <- cancer_types
colnames(mean_expression) <- colnames(heatmap_data)
for (cancer in cancer_types) {
cancer_samples <- which(labels$Class == cancer)
if (length(cancer_samples) > 0) {
mean_expression[cancer, ] <- colMeans(heatmap_data[cancer_samples, , drop = FALSE], na.rm = TRUE)
}
}
# æ ‡å‡†åŒ–
mean_expression_scaled <- t(scale(t(mean_expression)))
mean_expression_scaled[is.na(mean_expression_scaled)] <- 0
# ç»˜åˆ¶åˆ†ç»„çƒ­å›¾ - ä¿®æ”¹ä¸ºå•ç‹¬ä¿å­˜TIFFæ–‡ä»¶
tiff("mean_expression_by_cancer.tiff", width = 12, height = 6, units = "in", res = 300, compression = "lzw")
pheatmap(mean_expression_scaled,
main = "Mean Gene Expression by Cancer Type",
color = colorRampPalette(c("blue", "white", "red"))(100),
scale = "row",
cluster_rows = TRUE,
cluster_cols = TRUE,
show_rownames = TRUE,
show_colnames = TRUE,
fontsize_col = 7,
fontsize_row = 10,
border_color = "gray")
dev.off()
cat("âœ“ åˆ†ç»„å¹³å‡è¡¨è¾¾çƒ­å›¾å·²ä¿å­˜ä¸º mean_expression_by_cancer.tiff\n")
} else {
cat("é‡è¦æ•°æ®ä¸å¯ç”¨æˆ–åŸºå› å¤ªå°‘\n")
}
}, error = function(e) {
cat("çƒ­å›¾åˆ†æä¸»æµç¨‹é”™è¯¯:", e$message, "\n")
# æœ€åå°è¯•ï¼šæœ€ç®€å•çš„çƒ­å›¾
cat("å°è¯•æœ€åŸºæœ¬çš„heatmapå‡½æ•°...\n")
tryCatch({
tiff("basic_heatmap.tiff", width = 10, height = 8, units = "in", res = 300, compression = "lzw")
# ä½¿ç”¨åŸºç¡€heatmapå‡½æ•°
heatmap_data_subset <- as.matrix(important_data[, 1:min(20, ncol(important_data))])
# ç§»é™¤NA
heatmap_data_subset[is.na(heatmap_data_subset)] <- 0
heatmap(heatmap_data_subset,
col = colorRampPalette(c("blue", "white", "red"))(100),
main = "Basic Gene Expression Heatmap",
xlab = "Genes",
ylab = "Samples",
scale = "row",
labRow = FALSE,
cexCol = 0.7)
dev.off()
cat("âœ“ åŸºç¡€çƒ­å›¾å·²ä¿å­˜ä¸º basic_heatmap.tiff\n")
}, error = function(e2) {
cat("æœ€ç»ˆçƒ­å›¾å¤±è´¥:", e2$message, "\n")
})
})
# æ–¹æ³•8ï¼šç®±çº¿å›¾å¯è§†åŒ–é‡è¦åŸºå› è¡¨è¾¾
cat("\n=== å¼€å§‹é‡è¦åŸºå› è¡¨è¾¾åˆ†æ ===\n")
tryCatch({
if (exists("imp_df") && nrow(imp_df) >= 5) {
# ä½¿ç”¨å‰5ä¸ªåŸºå› 
n_genes_box <- min(5, nrow(imp_df))
top_genes <- imp_df$Gene[1:n_genes_box]
cat("åˆ†æåŸºå› :", paste(top_genes, collapse = ", "), "\n")
# å‡†å¤‡ç»˜å›¾æ•°æ®
plot_data <- important_data[, top_genes, drop = FALSE] %>%
as.data.frame() %>%
rownames_to_column("Sample") %>%
pivot_longer(cols = -Sample,
names_to = "Gene",
values_to = "Expression",
names_ptypes = list(Gene = factor(levels = top_genes))) %>%
left_join(data.frame(Sample = rownames(important_data),
Class = labels$Class),
by = "Sample")
# è®¾ç½®å› å­é¡ºåº
plot_data$Gene <- factor(plot_data$Gene, levels = top_genes)
# ç»˜åˆ¶ç®±çº¿å›¾ - ä¿®æ”¹ä¸ºå•ç‹¬ä¿å­˜TIFFæ–‡ä»¶
p_boxplot <- ggplot(plot_data, aes(x = Class, y = Expression, fill = Class)) +
geom_boxplot(alpha = 0.7, outlier.size = 0.5) +
facet_wrap(~ Gene, scales = "free_y", ncol = 3) +
scale_fill_brewer(palette = "Set2") +
theme_minimal(base_size = 12) +
labs(title = paste("Expression of Top", n_genes_box, "Important Genes by Cancer Type"),
x = "Cancer Type",
y = "Expression Level") +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "right",
plot.title = element_text(hjust = 0.5, face = "bold"))
ggsave("top_genes_boxplot.tiff", p_boxplot,
width = 14, height = 10, dpi = 300,
device = "tiff", compression = "lzw")
cat("âœ“ åŸºå› è¡¨è¾¾ç®±çº¿å›¾å·²ä¿å­˜ä¸º top_genes_boxplot.tiff\n")
} else {
cat("æ²¡æœ‰è¶³å¤Ÿçš„é‡è¦æ€§æ•°æ®è¿›è¡Œç®±çº¿å›¾åˆ†æ\n")
}
}, error = function(e) {
cat("ç®±çº¿å›¾ç»˜åˆ¶é”™è¯¯:", e$message, "\n")
})
# æ–¹æ³•9ï¼šå¤šæ–¹æ³•é™ç»´æ¯”è¾ƒ
cat("\n=== å¼€å§‹å¤šæ–¹æ³•é™ç»´æ¯”è¾ƒ ===\n")
tryCatch({
# å‡†å¤‡é™ç»´ç»“æœ
dim_reduction_results <- list(
PCA = pca_result$x[, 1:2],
tSNE = tsne_result$Y,
UMAP = umap_result$layout
)
# åˆ†åˆ«ä¿å­˜æ¯ä¸ªé™ç»´æ–¹æ³•çš„å›¾
for (method_name in names(dim_reduction_results)) {
dim_data <- dim_reduction_results[[method_name]]
plot_df <- data.frame(
Dim1 = dim_data[, 1],
Dim2 = dim_data[, 2],
Class = labels$Class
)
p <- ggplot(plot_df, aes(x = Dim1, y = Dim2, color = Class)) +
geom_point(size = 1.5, alpha = 0.6) +
stat_ellipse(level = 0.95, alpha = 0.2) +
theme_minimal() +
labs(title = paste(method_name, "Visualization"),
x = paste(method_name, "1"),
y = paste(method_name, "2")) +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "right")
filename <- paste0(tolower(method_name), "_visualization.tiff")
ggsave(filename, p,
width = 8, height = 6, dpi = 300,
device = "tiff", compression = "lzw")
cat("âœ“ ", method_name, "å¯è§†åŒ–å·²ä¿å­˜ä¸º ", filename, "\n", sep = "")
}
# åˆ›å»ºå›¾ä¾‹æ–‡ä»¶
p_legend <- ggplot(plot_df, aes(x = Dim1, y = Dim2, color = Class)) +
geom_point(size = 2) +
theme_void() +
theme(legend.position = "right",
legend.title = element_text(size = 10),
legend.text = element_text(size = 8))
ggsave("dimension_reduction_legend.tiff", p_legend,
width = 4, height = 6, dpi = 300,
device = "tiff", compression = "lzw")
cat("âœ“ å›¾ä¾‹å·²ä¿å­˜ä¸º dimension_reduction_legend.tiff\n")
}, error = function(e) {
cat("é™ç»´æ¯”è¾ƒé”™è¯¯:", e$message, "\n")
})
# æ–¹æ³•10ï¼šç®€åŒ–ç‰ˆæœºå™¨å­¦ä¹ æ¨¡å‹è¯„ä¼°
cat("\n=== å¼€å§‹ç®€åŒ–ç‰ˆæœºå™¨å­¦ä¹ æ¨¡å‹è¯„ä¼° ===\n")
tryCatch({
set.seed(123)
# å‡†å¤‡æ•°æ®
ml_data <- cbind(important_data, Class = y)
# åˆ’åˆ†è®­ç»ƒæµ‹è¯•é›†
train_index <- createDataPartition(y, p = 0.7, list = FALSE)
train_data <- ml_data[train_index, ]
test_data <- ml_data[-train_index, ]
# åªè®­ç»ƒéšæœºæ£®æ—æ¨¡å‹
cat("è®­ç»ƒéšæœºæ£®æ—æ¨¡å‹...\n")
rf_fit <- train(Class ~ .,
data = train_data,
method = "rf",
trControl = trainControl(method = "cv", number = 5),
tuneLength = 3,
ntree = 200)
# é¢„æµ‹
test_pred_rf <- predict(rf_fit, test_data)
# æ··æ·†çŸ©é˜µ
cm_rf <- confusionMatrix(test_pred_rf, test_data$Class)
# ä¿å­˜æ¨¡å‹æ€§èƒ½
model_performance <- data.frame(
Model = "RandomForest",
Accuracy = cm_rf$overall["Accuracy"],
Kappa = cm_rf$overall["Kappa"],
Sensitivity = mean(cm_rf$byClass[,"Sensitivity"], na.rm = TRUE),
Specificity = mean(cm_rf$byClass[,"Specificity"], na.rm = TRUE)
)
write.csv(model_performance, "model_performance_simple.csv", row.names = FALSE)
cat("âœ“ æ¨¡å‹æ€§èƒ½å·²ä¿å­˜ä¸º model_performance_simple.csv\n")
# ç»˜åˆ¶æ··æ·†çŸ©é˜µ - ä¿®æ”¹ä¸ºå•ç‹¬ä¿å­˜TIFFæ–‡ä»¶
cm_df <- as.data.frame(cm_rf$table)
p_cm <- ggplot(data = cm_df, aes(x = Reference, y = Prediction, fill = Freq)) +
geom_tile(color = "white") +
geom_text(aes(label = Freq), vjust = 1, size = 4) +
scale_fill_gradient(low = "white", high = "steelblue") +
theme_minimal(base_size = 12) +
labs(title = "Random Forest Confusion Matrix",
x = "True Class",
y = "Predicted Class",
fill = "Count") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggsave("confusion_matrix.tiff", p_cm,
width = 10, height = 8, dpi = 300,
device = "tiff", compression = "lzw")
cat("âœ“ æ··æ·†çŸ©é˜µå·²ä¿å­˜ä¸º confusion_matrix.tiff\n")
cat("\næ¨¡å‹æ€§èƒ½æ‘˜è¦:\n")
print(model_performance)
cat("\næ··æ·†çŸ©é˜µ:\n")
print(cm_rf$table)
}, error = function(e) {
cat("æœºå™¨å­¦ä¹ æ¨¡å‹è¯„ä¼°é”™è¯¯:", e$message, "\n")
# å°è¯•æ›´ç®€å•çš„æ–¹æ³•
tryCatch({
cat("å°è¯•ç®€å•éšæœºæ£®æ—...\n")
set.seed(123)
# ç›´æ¥ä½¿ç”¨randomForest
rf_simple <- randomForest(x = important_data[train_index, ],
y = y[train_index],
xtest = important_data[-train_index, ],
ytest = y[-train_index],
ntree = 200)
# è®¡ç®—å‡†ç¡®ç‡
accuracy <- sum(rf_simple$test$predicted == y[-train_index]) / length(y[-train_index])
cat("éšæœºæ£®æ—æµ‹è¯•å‡†ç¡®ç‡:", round(accuracy, 3), "\n")
simple_perf <- data.frame(
Model = "RandomForest_Simple",
Accuracy = accuracy
)
write.csv(simple_perf, "simple_model_performance.csv", row.names = FALSE)
}, error = function(e2) {
cat("ç®€å•æ¨¡å‹ä¹Ÿå¤±è´¥:", e2$message, "\n")
})
})
# æ–¹æ³•11ï¼šç‰¹å¾ç›¸å…³æ€§åˆ†æ
cat("\n=== å¼€å§‹ç‰¹å¾ç›¸å…³æ€§åˆ†æ ===\n")
tryCatch({
if (ncol(important_data) > 1) {
# è®¡ç®—ç‰¹å¾é—´çš„ç›¸å…³æ€§
cor_matrix <- cor(important_data)
# å¯è§†åŒ–ç›¸å…³æ€§çŸ©é˜µ - ä¿®æ”¹ä¸ºå•ç‹¬ä¿å­˜TIFFæ–‡ä»¶
tiff("feature_correlation.tiff", width = 10, height = 8, units = "in", res = 300, compression = "lzw")
corrplot(cor_matrix,
method = "color",
type = "upper",
tl.col = "black",
tl.srt = 45,
addCoef.col = "black",
number.cex = 0.5,
title = "Correlation between Important Features")
dev.off()
cat("âœ“ ç‰¹å¾ç›¸å…³æ€§å›¾å·²ä¿å­˜ä¸º feature_correlation.tiff\n")
# æå–é«˜åº¦ç›¸å…³çš„ç‰¹å¾å¯¹
cor_threshold <- 0.7
high_cor_pairs <- which(abs(cor_matrix) > cor_threshold &
upper.tri(cor_matrix), arr.ind = TRUE)
if (nrow(high_cor_pairs) > 0) {
high_cor_df <- data.frame(
Gene1 = colnames(cor_matrix)[high_cor_pairs[, 1]],
Gene2 = colnames(cor_matrix)[high_cor_pairs[, 2]],
Correlation = cor_matrix[high_cor_pairs]
) %>%
arrange(desc(abs(Correlation)))
write.csv(high_cor_df, "high_correlation_pairs.csv", row.names = FALSE)
cat("âœ“ é«˜ç›¸å…³æ€§åŸºå› å¯¹å·²ä¿å­˜ä¸º high_correlation_pairs.csv\n")
cat("  å‘ç°", nrow(high_cor_df), "å¯¹é«˜åº¦ç›¸å…³åŸºå›  (|r| >", cor_threshold, ")\n")
}
}
}, error = function(e) {
cat("ç›¸å…³æ€§åˆ†æé”™è¯¯:", e$message, "\n")
})
# æ–¹æ³•12ï¼šPCA loadingsåˆ†æ
cat("\n=== å¼€å§‹PCA loadingsåˆ†æ ===\n")
tryCatch({
# æå–å‰5ä¸ªä¸»æˆåˆ†çš„loadings
n_pc <- min(5, ncol(pca_result$rotation))
loadings_df <- as.data.frame(pca_result$rotation[, 1:n_pc])
colnames(loadings_df) <- paste0("PC", 1:n_pc)
loadings_df$Gene <- rownames(loadings_df)
# å¯¹æ¯ä¸ªä¸»æˆåˆ†ï¼Œæå–æœ€é‡è¦çš„åŸºå› 
for (i in 1:n_pc) {
pc_name <- paste0("PC", i)
pc_loadings <- loadings_df[, c("Gene", pc_name)]
pc_loadings <- pc_loadings[order(abs(pc_loadings[, pc_name]), decreasing = TRUE), ]
# ä¿å­˜å‰20ä¸ªåŸºå› 
top_genes <- head(pc_loadings, 20)
write.csv(top_genes,
paste0("pc", i, "_top_loadings.csv"),
row.names = FALSE)
cat("âœ“ PC", i, "çš„loadingså·²ä¿å­˜ä¸º pc", i, "_top_loadings.csv\n", sep = "")
}
# å¯è§†åŒ–PC1 vs PC2 loadings - ä¿®æ”¹ä¸ºå•ç‹¬ä¿å­˜TIFFæ–‡ä»¶
p_loadings <- ggplot(loadings_df, aes(x = PC1, y = PC2)) +
geom_point(alpha = 0.5, size = 1) +
geom_hline(yintercept = 0, linetype = "dashed", alpha = 0.5) +
geom_vline(xintercept = 0, linetype = "dashed", alpha = 0.5) +
theme_minimal() +
labs(title = "PCA Loadings Plot (PC1 vs PC2)",
x = "PC1 Loadings",
y = "PC2 Loadings")
ggsave("pca_loadings_plot.tiff", p_loadings,
width = 10, height = 8, dpi = 300,
device = "tiff", compression = "lzw")
cat("âœ“ PCA loadingså›¾å·²ä¿å­˜ä¸º pca_loadings_plot.tiff\n")
# æ·»åŠ ç‰¹å¾è½½è·æ¡å½¢å›¾
p_loadings_bar <- ggplot(head(loadings_df[order(abs(loadings_df$PC1), decreasing = TRUE), ], 20),
aes(x = reorder(Gene, PC1), y = PC1)) +
geom_bar(stat = "identity", fill = "steelblue", alpha = 0.8) +
coord_flip() +
theme_minimal(base_size = 10) +
labs(title = "Top 20 Gene Loadings on PC1",
x = "Gene",
y = "PC1 Loading")
ggsave("pc1_top_loadings_bar.tiff", p_loadings_bar,
width = 10, height = 8, dpi = 300,
device = "tiff", compression = "lzw")
cat("âœ“ PC1ç‰¹å¾è½½è·æ¡å½¢å›¾å·²ä¿å­˜ä¸º pc1_top_loadings_bar.tiff\n")
}, error = function(e) {
cat("PCA loadingsåˆ†æé”™è¯¯:", e$message, "\n")
})
# ç”Ÿæˆæœ€ç»ˆæ±‡æ€»æŠ¥å‘Š
cat("\n=== ç”Ÿæˆæœ€ç»ˆæ±‡æ€»æŠ¥å‘Š ===\n")
final_summary <- data.frame(
Metric = c(
"Total Samples",
"Total Genes",
"Genes after Filtering",
"Cancer Types",
"BRCA Samples",
"COAD Samples",
"KIRC Samples",
"LUAD Samples",
"PRAD Samples",
"LASSO Selected Genes",
"PCA Components (80% Variance)",
"PCA Components (90% Variance)",
"Top Gene (Random Forest)",
"RF MeanDecreaseAccuracy"
),
Value = c(
nrow(data_clean),
ncol(data),
ncol(data_clean),
length(unique(y)),
sum(y == "BRCA"),
sum(y == "COAD"),
sum(y == "KIRC"),
sum(y == "LUAD"),
sum(y == "PRAD"),
length(important_features),
which(summary(pca_result)$importance[3,] >= 0.8)[1],
which(summary(pca_result)$importance[3,] >= 0.9)[1],
if (exists("imp_df") && nrow(imp_df) > 0) imp_df$Gene[1] else "N/A",
if (exists("imp_df") && nrow(imp_df) > 0) round(imp_df$MeanDecreaseAccuracy[1], 3) else "N/A"
)
)
write.csv(final_summary, "final_analysis_summary.csv", row.names = FALSE)
cat("âœ“ æœ€ç»ˆæ±‡æ€»å·²ä¿å­˜ä¸º final_analysis_summary.csv\n")
# ä¿å­˜Rå·¥ä½œç©ºé—´
save.image("complete_analysis.RData")
cat("âœ“ å®Œæ•´Rå·¥ä½œç©ºé—´å·²ä¿å­˜ä¸º complete_analysis.RData\n")
cat("\nğŸ‰ åŸºå› è¡¨è¾¾æ•°æ®åˆ†æå®Œæˆï¼\n")
cat("ğŸ“ å·²ç”Ÿæˆçš„åˆ†ææ–‡ä»¶:\n")
cat("\n1. ğŸ–¼ï¸ å¯è§†åŒ–æ–‡ä»¶ (TIFFæ ¼å¼):\n")
cat("   â”œâ”€â”€ pca_eigenvalues.tiff               - PCAç‰¹å¾å€¼å›¾\n")
cat("   â”œâ”€â”€ pca_individuals.tiff               - PCAä¸ªä½“å›¾\n")
cat("   â”œâ”€â”€ pca_biplot.tiff                    - PCAåŒæ ‡å›¾\n")
cat("   â”œâ”€â”€ tsne_plot.tiff                     - t-SNEå¯è§†åŒ–\n")
cat("   â”œâ”€â”€ umap_plot.tiff                     - UMAPå¯è§†åŒ–\n")
cat("   â”œâ”€â”€ pca_visualization.tiff             - PCAå¯è§†åŒ–\n")
cat("   â”œâ”€â”€ tsne_visualization.tiff            - t-SNEå¯è§†åŒ–\n")
cat("   â”œâ”€â”€ umap_visualization.tiff            - UMAPå¯è§†åŒ–\n")
cat("   â”œâ”€â”€ dimension_reduction_legend.tiff    - é™ç»´å›¾ä¾‹\n")
cat("   â”œâ”€â”€ lasso_cv.tiff                      - LASSOäº¤å‰éªŒè¯\n")
cat("   â”œâ”€â”€ hierarchical_dendrogram.tiff       - å±‚æ¬¡èšç±»æ ‘\n")
cat("   â”œâ”€â”€ rf_importance.tiff                 - éšæœºæ£®æ—ç‰¹å¾é‡è¦æ€§\n")
cat("   â”œâ”€â”€ rf_top20_features.tiff            - å‰20ä¸ªé‡è¦ç‰¹å¾\n")
cat("   â”œâ”€â”€ top_genes_heatmap.tiff             - é‡è¦åŸºå› çƒ­å›¾\n")
cat("   â”œâ”€â”€ mean_expression_by_cancer.tiff     - åˆ†ç»„å¹³å‡è¡¨è¾¾çƒ­å›¾\n")
cat("   â”œâ”€â”€ top_genes_boxplot.tiff             - åŸºå› è¡¨è¾¾ç®±çº¿å›¾\n")
cat("   â”œâ”€â”€ confusion_matrix.tiff              - æ··æ·†çŸ©é˜µ\n")
cat("   â”œâ”€â”€ feature_correlation.tiff           - ç‰¹å¾ç›¸å…³æ€§å›¾\n")
cat("   â”œâ”€â”€ pca_loadings_plot.tiff             - PCA loadingså›¾\n")
cat("   â””â”€â”€ pc1_top_loadings_bar.tiff          - PC1ç‰¹å¾è½½è·æ¡å½¢å›¾\n")
cat("\n2. ğŸ“ æ•°æ®æ–‡ä»¶ (CSVæ ¼å¼):\n")
cat("   â”œâ”€â”€ feature_importance_ranking.csv     - ç‰¹å¾é‡è¦æ€§æ’å\n")
cat("   â”œâ”€â”€ model_performance_simple.csv       - æ¨¡å‹æ€§èƒ½\n")
cat("   â”œâ”€â”€ high_correlation_pairs.csv         - é«˜ç›¸å…³æ€§åŸºå› å¯¹\n")
cat("   â”œâ”€â”€ final_analysis_summary.csv         - æœ€ç»ˆæ±‡æ€»\n")
cat("   â”œâ”€â”€ pc1_top_loadings.csv               - PC1 loadings\n")
cat("   â”œâ”€â”€ pc2_top_loadings.csv               - PC2 loadings\n")
cat("   â”œâ”€â”€ pc3_top_loadings.csv               - PC3 loadings\n")
cat("   â”œâ”€â”€ pc4_top_loadings.csv               - PC4 loadings\n")
cat("   â””â”€â”€ pc5_top_loadings.csv               - PC5 loadings\n")
cat("\n3. ğŸ’¾ å·¥ä½œç©ºé—´æ–‡ä»¶:\n")
cat("   â””â”€â”€ complete_analysis.RData            - å®Œæ•´Rå·¥ä½œç©ºé—´\n")
cat("\n4. ğŸ“ˆ åˆ†ææ‘˜è¦:\n")
cat("   - æ ·æœ¬æ€»æ•°: ", nrow(data_clean), "\n")
cat("   - åŸºå› æ€»æ•°: ", ncol(data_clean), "\n")
cat("   - ç™Œç—‡ç±»å‹: ", length(unique(y)), "ç§\n")
cat("   - LASSOé€‰æ‹©åŸºå› : ", length(important_features), "ä¸ª\n")
cat("   - PCAè§£é‡Š80%æ–¹å·®æ‰€éœ€ä¸»æˆåˆ†: ", which(summary(pca_result)$importance[3,] >= 0.8)[1], "\n")
if (exists("imp_df") && nrow(imp_df) > 0) {
cat("   - æœ€é‡è¦çš„åŸºå› : ", imp_df$Gene[1], "\n")
cat("   - å…¶é‡è¦æ€§å¾—åˆ†: ", round(imp_df$MeanDecreaseAccuracy[1], 3), "\n")
}
cat("   - ç”Ÿæˆå›¾ç‰‡æ€»æ•°: 20+ ä¸ªTIFFæ–‡ä»¶\n")
cat("\nğŸ“Š æ‰€æœ‰å›¾ç‰‡å·²å•ç‹¬ä¿å­˜ä¸ºé«˜è´¨é‡TIFFæ ¼å¼ï¼Œä¾¿äºè®ºæ–‡å‘è¡¨ä½¿ç”¨ï¼\n")
